{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Watchpack = require(\"watchpack\");\nconst objectToMap = require(\"../util/objectToMap\");\nclass NodeWatchFileSystem {\n  constructor(inputFileSystem) {\n    this.inputFileSystem = inputFileSystem;\n    this.watcherOptions = {\n      aggregateTimeout: 0\n    };\n    this.watcher = new Watchpack(this.watcherOptions);\n  }\n  watch(files, dirs, missing, startTime, options, callback, callbackUndelayed) {\n    if (!Array.isArray(files)) {\n      throw new Error(\"Invalid arguments: 'files'\");\n    }\n    if (!Array.isArray(dirs)) {\n      throw new Error(\"Invalid arguments: 'dirs'\");\n    }\n    if (!Array.isArray(missing)) {\n      throw new Error(\"Invalid arguments: 'missing'\");\n    }\n    if (typeof callback !== \"function\") {\n      throw new Error(\"Invalid arguments: 'callback'\");\n    }\n    if (typeof startTime !== \"number\" && startTime) {\n      throw new Error(\"Invalid arguments: 'startTime'\");\n    }\n    if (typeof options !== \"object\") {\n      throw new Error(\"Invalid arguments: 'options'\");\n    }\n    if (typeof callbackUndelayed !== \"function\" && callbackUndelayed) {\n      throw new Error(\"Invalid arguments: 'callbackUndelayed'\");\n    }\n    const oldWatcher = this.watcher;\n    this.watcher = new Watchpack(options);\n    if (callbackUndelayed) {\n      this.watcher.once(\"change\", callbackUndelayed);\n    }\n    const cachedFiles = files;\n    const cachedDirs = dirs;\n    this.watcher.once(\"aggregated\", (changes, removals) => {\n      changes = changes.concat(removals);\n      if (this.inputFileSystem && this.inputFileSystem.purge) {\n        this.inputFileSystem.purge(changes);\n      }\n      const times = objectToMap(this.watcher.getTimes());\n      files = new Set(files);\n      dirs = new Set(dirs);\n      missing = new Set(missing);\n      removals = new Set(removals.filter(file => files.has(file)));\n      callback(null, changes.filter(file => files.has(file)).sort(), changes.filter(file => dirs.has(file)).sort(), changes.filter(file => missing.has(file)).sort(), times, times, removals);\n    });\n    this.watcher.watch(cachedFiles.concat(missing), cachedDirs.concat(missing), startTime);\n    if (oldWatcher) {\n      oldWatcher.close();\n    }\n    return {\n      close: () => {\n        if (this.watcher) {\n          this.watcher.close();\n          this.watcher = null;\n        }\n      },\n      pause: () => {\n        if (this.watcher) {\n          this.watcher.pause();\n        }\n      },\n      getFileTimestamps: () => {\n        if (this.watcher) {\n          return objectToMap(this.watcher.getTimes());\n        } else {\n          return new Map();\n        }\n      },\n      getContextTimestamps: () => {\n        if (this.watcher) {\n          return objectToMap(this.watcher.getTimes());\n        } else {\n          return new Map();\n        }\n      }\n    };\n  }\n}\nmodule.exports = NodeWatchFileSystem;","map":{"version":3,"names":["Watchpack","require","objectToMap","NodeWatchFileSystem","constructor","inputFileSystem","watcherOptions","aggregateTimeout","watcher","watch","files","dirs","missing","startTime","options","callback","callbackUndelayed","Array","isArray","Error","oldWatcher","once","cachedFiles","cachedDirs","changes","removals","concat","purge","times","getTimes","Set","filter","file","has","sort","close","pause","getFileTimestamps","Map","getContextTimestamps","module","exports"],"sources":["/home/soon/bulletin-board/node_modules/webpack/lib/node/NodeWatchFileSystem.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Watchpack = require(\"watchpack\");\nconst objectToMap = require(\"../util/objectToMap\");\n\nclass NodeWatchFileSystem {\n\tconstructor(inputFileSystem) {\n\t\tthis.inputFileSystem = inputFileSystem;\n\t\tthis.watcherOptions = {\n\t\t\taggregateTimeout: 0\n\t\t};\n\t\tthis.watcher = new Watchpack(this.watcherOptions);\n\t}\n\n\twatch(files, dirs, missing, startTime, options, callback, callbackUndelayed) {\n\t\tif (!Array.isArray(files)) {\n\t\t\tthrow new Error(\"Invalid arguments: 'files'\");\n\t\t}\n\t\tif (!Array.isArray(dirs)) {\n\t\t\tthrow new Error(\"Invalid arguments: 'dirs'\");\n\t\t}\n\t\tif (!Array.isArray(missing)) {\n\t\t\tthrow new Error(\"Invalid arguments: 'missing'\");\n\t\t}\n\t\tif (typeof callback !== \"function\") {\n\t\t\tthrow new Error(\"Invalid arguments: 'callback'\");\n\t\t}\n\t\tif (typeof startTime !== \"number\" && startTime) {\n\t\t\tthrow new Error(\"Invalid arguments: 'startTime'\");\n\t\t}\n\t\tif (typeof options !== \"object\") {\n\t\t\tthrow new Error(\"Invalid arguments: 'options'\");\n\t\t}\n\t\tif (typeof callbackUndelayed !== \"function\" && callbackUndelayed) {\n\t\t\tthrow new Error(\"Invalid arguments: 'callbackUndelayed'\");\n\t\t}\n\t\tconst oldWatcher = this.watcher;\n\t\tthis.watcher = new Watchpack(options);\n\n\t\tif (callbackUndelayed) {\n\t\t\tthis.watcher.once(\"change\", callbackUndelayed);\n\t\t}\n\t\tconst cachedFiles = files;\n\t\tconst cachedDirs = dirs;\n\t\tthis.watcher.once(\"aggregated\", (changes, removals) => {\n\t\t\tchanges = changes.concat(removals);\n\t\t\tif (this.inputFileSystem && this.inputFileSystem.purge) {\n\t\t\t\tthis.inputFileSystem.purge(changes);\n\t\t\t}\n\t\t\tconst times = objectToMap(this.watcher.getTimes());\n\t\t\tfiles = new Set(files);\n\t\t\tdirs = new Set(dirs);\n\t\t\tmissing = new Set(missing);\n\t\t\tremovals = new Set(removals.filter(file => files.has(file)));\n\t\t\tcallback(\n\t\t\t\tnull,\n\t\t\t\tchanges.filter(file => files.has(file)).sort(),\n\t\t\t\tchanges.filter(file => dirs.has(file)).sort(),\n\t\t\t\tchanges.filter(file => missing.has(file)).sort(),\n\t\t\t\ttimes,\n\t\t\t\ttimes,\n\t\t\t\tremovals\n\t\t\t);\n\t\t});\n\n\t\tthis.watcher.watch(\n\t\t\tcachedFiles.concat(missing),\n\t\t\tcachedDirs.concat(missing),\n\t\t\tstartTime\n\t\t);\n\n\t\tif (oldWatcher) {\n\t\t\toldWatcher.close();\n\t\t}\n\t\treturn {\n\t\t\tclose: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\tthis.watcher.close();\n\t\t\t\t\tthis.watcher = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\tpause: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\tthis.watcher.pause();\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetFileTimestamps: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\treturn objectToMap(this.watcher.getTimes());\n\t\t\t\t} else {\n\t\t\t\t\treturn new Map();\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetContextTimestamps: () => {\n\t\t\t\tif (this.watcher) {\n\t\t\t\t\treturn objectToMap(this.watcher.getTimes());\n\t\t\t\t} else {\n\t\t\t\t\treturn new Map();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n}\n\nmodule.exports = NodeWatchFileSystem;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}