{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _os = _interopRequireDefault(require(\"os\"));\nvar _cacache = _interopRequireDefault(require(\"cacache\"));\nvar _findCacheDir = _interopRequireDefault(require(\"find-cache-dir\"));\nvar _workerFarm = _interopRequireDefault(require(\"worker-farm\"));\nvar _serializeJavascript = _interopRequireDefault(require(\"serialize-javascript\"));\nvar _isWsl = _interopRequireDefault(require(\"is-wsl\"));\nvar _minify = _interopRequireDefault(require(\"./minify\"));\nfunction _interopRequireDefault(e) {\n  return e && e.__esModule ? e : {\n    default: e\n  };\n}\nconst worker = require.resolve('./worker');\nclass TaskRunner {\n  constructor(options = {}) {\n    const {\n      cache,\n      parallel\n    } = options;\n    this.cacheDir = cache === true ? (0, _findCacheDir.default)({\n      name: 'terser-webpack-plugin'\n    }) || _os.default.tmpdir() : cache;\n    // In some cases cpus() returns undefined\n    // https://github.com/nodejs/node/issues/19022\n    const cpus = _os.default.cpus() || {\n      length: 1\n    };\n    // WSL sometimes freezes, error seems to be on the WSL side\n    // https://github.com/webpack-contrib/terser-webpack-plugin/issues/21\n    this.maxConcurrentWorkers = _isWsl.default ? 1 : parallel === true ? cpus.length - 1 : Math.min(Number(parallel) || 0, cpus.length - 1);\n  }\n  run(tasks, callback) {\n    /* istanbul ignore if */\n    if (!tasks.length) {\n      callback(null, []);\n      return;\n    }\n    if (this.maxConcurrentWorkers > 1) {\n      const workerOptions = process.platform === 'win32' ? {\n        maxConcurrentWorkers: this.maxConcurrentWorkers,\n        maxConcurrentCallsPerWorker: 1\n      } : {\n        maxConcurrentWorkers: this.maxConcurrentWorkers\n      };\n      this.workers = (0, _workerFarm.default)(workerOptions, worker);\n      this.boundWorkers = (options, cb) => {\n        try {\n          this.workers((0, _serializeJavascript.default)(options), cb);\n        } catch (error) {\n          // worker-farm can fail with ENOMEM or something else\n          cb(error);\n        }\n      };\n    } else {\n      this.boundWorkers = (options, cb) => {\n        try {\n          cb(null, (0, _minify.default)(options));\n        } catch (error) {\n          cb(error);\n        }\n      };\n    }\n    let toRun = tasks.length;\n    const results = [];\n    const step = (index, data) => {\n      toRun -= 1;\n      results[index] = data;\n      if (!toRun) {\n        callback(null, results);\n      }\n    };\n    tasks.forEach((task, index) => {\n      const enqueue = () => {\n        this.boundWorkers(task, (error, data) => {\n          const result = error ? {\n            error\n          } : data;\n          const done = () => step(index, result);\n          if (this.cacheDir && !result.error) {\n            _cacache.default.put(this.cacheDir, (0, _serializeJavascript.default)(task.cacheKeys), JSON.stringify(data)).then(done, done);\n          } else {\n            done();\n          }\n        });\n      };\n      if (this.cacheDir) {\n        _cacache.default.get(this.cacheDir, (0, _serializeJavascript.default)(task.cacheKeys)).then(({\n          data\n        }) => step(index, JSON.parse(data)), enqueue);\n      } else {\n        enqueue();\n      }\n    });\n  }\n  exit() {\n    if (this.workers) {\n      _workerFarm.default.end(this.workers);\n    }\n  }\n}\nexports.default = TaskRunner;","map":{"version":3,"names":["Object","defineProperty","exports","value","default","_os","_interopRequireDefault","require","_cacache","_findCacheDir","_workerFarm","_serializeJavascript","_isWsl","_minify","e","__esModule","worker","resolve","TaskRunner","constructor","options","cache","parallel","cacheDir","name","tmpdir","cpus","length","maxConcurrentWorkers","Math","min","Number","run","tasks","callback","workerOptions","process","platform","maxConcurrentCallsPerWorker","workers","boundWorkers","cb","error","toRun","results","step","index","data","forEach","task","enqueue","result","done","put","cacheKeys","JSON","stringify","then","get","parse","exit","end"],"sources":["/home/soon/bulletin-board/node_modules/webpack/node_modules/terser-webpack-plugin/dist/TaskRunner.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _os = _interopRequireDefault(require(\"os\"));\nvar _cacache = _interopRequireDefault(require(\"cacache\"));\nvar _findCacheDir = _interopRequireDefault(require(\"find-cache-dir\"));\nvar _workerFarm = _interopRequireDefault(require(\"worker-farm\"));\nvar _serializeJavascript = _interopRequireDefault(require(\"serialize-javascript\"));\nvar _isWsl = _interopRequireDefault(require(\"is-wsl\"));\nvar _minify = _interopRequireDefault(require(\"./minify\"));\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }\nconst worker = require.resolve('./worker');\nclass TaskRunner {\n  constructor(options = {}) {\n    const {\n      cache,\n      parallel\n    } = options;\n    this.cacheDir = cache === true ? (0, _findCacheDir.default)({\n      name: 'terser-webpack-plugin'\n    }) || _os.default.tmpdir() : cache;\n    // In some cases cpus() returns undefined\n    // https://github.com/nodejs/node/issues/19022\n    const cpus = _os.default.cpus() || {\n      length: 1\n    };\n    // WSL sometimes freezes, error seems to be on the WSL side\n    // https://github.com/webpack-contrib/terser-webpack-plugin/issues/21\n    this.maxConcurrentWorkers = _isWsl.default ? 1 : parallel === true ? cpus.length - 1 : Math.min(Number(parallel) || 0, cpus.length - 1);\n  }\n  run(tasks, callback) {\n    /* istanbul ignore if */\n    if (!tasks.length) {\n      callback(null, []);\n      return;\n    }\n    if (this.maxConcurrentWorkers > 1) {\n      const workerOptions = process.platform === 'win32' ? {\n        maxConcurrentWorkers: this.maxConcurrentWorkers,\n        maxConcurrentCallsPerWorker: 1\n      } : {\n        maxConcurrentWorkers: this.maxConcurrentWorkers\n      };\n      this.workers = (0, _workerFarm.default)(workerOptions, worker);\n      this.boundWorkers = (options, cb) => {\n        try {\n          this.workers((0, _serializeJavascript.default)(options), cb);\n        } catch (error) {\n          // worker-farm can fail with ENOMEM or something else\n          cb(error);\n        }\n      };\n    } else {\n      this.boundWorkers = (options, cb) => {\n        try {\n          cb(null, (0, _minify.default)(options));\n        } catch (error) {\n          cb(error);\n        }\n      };\n    }\n    let toRun = tasks.length;\n    const results = [];\n    const step = (index, data) => {\n      toRun -= 1;\n      results[index] = data;\n      if (!toRun) {\n        callback(null, results);\n      }\n    };\n    tasks.forEach((task, index) => {\n      const enqueue = () => {\n        this.boundWorkers(task, (error, data) => {\n          const result = error ? {\n            error\n          } : data;\n          const done = () => step(index, result);\n          if (this.cacheDir && !result.error) {\n            _cacache.default.put(this.cacheDir, (0, _serializeJavascript.default)(task.cacheKeys), JSON.stringify(data)).then(done, done);\n          } else {\n            done();\n          }\n        });\n      };\n      if (this.cacheDir) {\n        _cacache.default.get(this.cacheDir, (0, _serializeJavascript.default)(task.cacheKeys)).then(({\n          data\n        }) => step(index, JSON.parse(data)), enqueue);\n      } else {\n        enqueue();\n      }\n    });\n  }\n  exit() {\n    if (this.workers) {\n      _workerFarm.default.end(this.workers);\n    }\n  }\n}\nexports.default = TaskRunner;"],"mappings":"AAAA,YAAY;;AAEZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAC3CC,KAAK,EAAE;AACT,CAAC,CAAC;AACFD,OAAO,CAACE,OAAO,GAAG,KAAK,CAAC;AACxB,IAAIC,GAAG,GAAGC,sBAAsB,CAACC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC/C,IAAIC,QAAQ,GAAGF,sBAAsB,CAACC,OAAO,CAAC,SAAS,CAAC,CAAC;AACzD,IAAIE,aAAa,GAAGH,sBAAsB,CAACC,OAAO,CAAC,gBAAgB,CAAC,CAAC;AACrE,IAAIG,WAAW,GAAGJ,sBAAsB,CAACC,OAAO,CAAC,aAAa,CAAC,CAAC;AAChE,IAAII,oBAAoB,GAAGL,sBAAsB,CAACC,OAAO,CAAC,sBAAsB,CAAC,CAAC;AAClF,IAAIK,MAAM,GAAGN,sBAAsB,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC;AACtD,IAAIM,OAAO,GAAGP,sBAAsB,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC;AACzD,SAASD,sBAAsBA,CAACQ,CAAC,EAAE;EAAE,OAAOA,CAAC,IAAIA,CAAC,CAACC,UAAU,GAAGD,CAAC,GAAG;IAAEV,OAAO,EAAEU;EAAE,CAAC;AAAE;AACpF,MAAME,MAAM,GAAGT,OAAO,CAACU,OAAO,CAAC,UAAU,CAAC;AAC1C,MAAMC,UAAU,CAAC;EACfC,WAAWA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;IACxB,MAAM;MACJC,KAAK;MACLC;IACF,CAAC,GAAGF,OAAO;IACX,IAAI,CAACG,QAAQ,GAAGF,KAAK,KAAK,IAAI,GAAG,CAAC,CAAC,EAAEZ,aAAa,CAACL,OAAO,EAAE;MAC1DoB,IAAI,EAAE;IACR,CAAC,CAAC,IAAInB,GAAG,CAACD,OAAO,CAACqB,MAAM,CAAC,CAAC,GAAGJ,KAAK;IAClC;IACA;IACA,MAAMK,IAAI,GAAGrB,GAAG,CAACD,OAAO,CAACsB,IAAI,CAAC,CAAC,IAAI;MACjCC,MAAM,EAAE;IACV,CAAC;IACD;IACA;IACA,IAAI,CAACC,oBAAoB,GAAGhB,MAAM,CAACR,OAAO,GAAG,CAAC,GAAGkB,QAAQ,KAAK,IAAI,GAAGI,IAAI,CAACC,MAAM,GAAG,CAAC,GAAGE,IAAI,CAACC,GAAG,CAACC,MAAM,CAACT,QAAQ,CAAC,IAAI,CAAC,EAAEI,IAAI,CAACC,MAAM,GAAG,CAAC,CAAC;EACzI;EACAK,GAAGA,CAACC,KAAK,EAAEC,QAAQ,EAAE;IACnB;IACA,IAAI,CAACD,KAAK,CAACN,MAAM,EAAE;MACjBO,QAAQ,CAAC,IAAI,EAAE,EAAE,CAAC;MAClB;IACF;IACA,IAAI,IAAI,CAACN,oBAAoB,GAAG,CAAC,EAAE;MACjC,MAAMO,aAAa,GAAGC,OAAO,CAACC,QAAQ,KAAK,OAAO,GAAG;QACnDT,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;QAC/CU,2BAA2B,EAAE;MAC/B,CAAC,GAAG;QACFV,oBAAoB,EAAE,IAAI,CAACA;MAC7B,CAAC;MACD,IAAI,CAACW,OAAO,GAAG,CAAC,CAAC,EAAE7B,WAAW,CAACN,OAAO,EAAE+B,aAAa,EAAEnB,MAAM,CAAC;MAC9D,IAAI,CAACwB,YAAY,GAAG,CAACpB,OAAO,EAAEqB,EAAE,KAAK;QACnC,IAAI;UACF,IAAI,CAACF,OAAO,CAAC,CAAC,CAAC,EAAE5B,oBAAoB,CAACP,OAAO,EAAEgB,OAAO,CAAC,EAAEqB,EAAE,CAAC;QAC9D,CAAC,CAAC,OAAOC,KAAK,EAAE;UACd;UACAD,EAAE,CAACC,KAAK,CAAC;QACX;MACF,CAAC;IACH,CAAC,MAAM;MACL,IAAI,CAACF,YAAY,GAAG,CAACpB,OAAO,EAAEqB,EAAE,KAAK;QACnC,IAAI;UACFA,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE5B,OAAO,CAACT,OAAO,EAAEgB,OAAO,CAAC,CAAC;QACzC,CAAC,CAAC,OAAOsB,KAAK,EAAE;UACdD,EAAE,CAACC,KAAK,CAAC;QACX;MACF,CAAC;IACH;IACA,IAAIC,KAAK,GAAGV,KAAK,CAACN,MAAM;IACxB,MAAMiB,OAAO,GAAG,EAAE;IAClB,MAAMC,IAAI,GAAGA,CAACC,KAAK,EAAEC,IAAI,KAAK;MAC5BJ,KAAK,IAAI,CAAC;MACVC,OAAO,CAACE,KAAK,CAAC,GAAGC,IAAI;MACrB,IAAI,CAACJ,KAAK,EAAE;QACVT,QAAQ,CAAC,IAAI,EAAEU,OAAO,CAAC;MACzB;IACF,CAAC;IACDX,KAAK,CAACe,OAAO,CAAC,CAACC,IAAI,EAAEH,KAAK,KAAK;MAC7B,MAAMI,OAAO,GAAGA,CAAA,KAAM;QACpB,IAAI,CAACV,YAAY,CAACS,IAAI,EAAE,CAACP,KAAK,EAAEK,IAAI,KAAK;UACvC,MAAMI,MAAM,GAAGT,KAAK,GAAG;YACrBA;UACF,CAAC,GAAGK,IAAI;UACR,MAAMK,IAAI,GAAGA,CAAA,KAAMP,IAAI,CAACC,KAAK,EAAEK,MAAM,CAAC;UACtC,IAAI,IAAI,CAAC5B,QAAQ,IAAI,CAAC4B,MAAM,CAACT,KAAK,EAAE;YAClClC,QAAQ,CAACJ,OAAO,CAACiD,GAAG,CAAC,IAAI,CAAC9B,QAAQ,EAAE,CAAC,CAAC,EAAEZ,oBAAoB,CAACP,OAAO,EAAE6C,IAAI,CAACK,SAAS,CAAC,EAAEC,IAAI,CAACC,SAAS,CAACT,IAAI,CAAC,CAAC,CAACU,IAAI,CAACL,IAAI,EAAEA,IAAI,CAAC;UAC/H,CAAC,MAAM;YACLA,IAAI,CAAC,CAAC;UACR;QACF,CAAC,CAAC;MACJ,CAAC;MACD,IAAI,IAAI,CAAC7B,QAAQ,EAAE;QACjBf,QAAQ,CAACJ,OAAO,CAACsD,GAAG,CAAC,IAAI,CAACnC,QAAQ,EAAE,CAAC,CAAC,EAAEZ,oBAAoB,CAACP,OAAO,EAAE6C,IAAI,CAACK,SAAS,CAAC,CAAC,CAACG,IAAI,CAAC,CAAC;UAC3FV;QACF,CAAC,KAAKF,IAAI,CAACC,KAAK,EAAES,IAAI,CAACI,KAAK,CAACZ,IAAI,CAAC,CAAC,EAAEG,OAAO,CAAC;MAC/C,CAAC,MAAM;QACLA,OAAO,CAAC,CAAC;MACX;IACF,CAAC,CAAC;EACJ;EACAU,IAAIA,CAAA,EAAG;IACL,IAAI,IAAI,CAACrB,OAAO,EAAE;MAChB7B,WAAW,CAACN,OAAO,CAACyD,GAAG,CAAC,IAAI,CAACtB,OAAO,CAAC;IACvC;EACF;AACF;AACArC,OAAO,CAACE,OAAO,GAAGc,UAAU","ignoreList":[]},"metadata":{},"sourceType":"script"}