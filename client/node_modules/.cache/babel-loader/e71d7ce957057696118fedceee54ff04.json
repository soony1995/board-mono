{"ast":null,"code":"var Transform = require('readable-stream').Transform;\nvar inherits = require('inherits');\nvar cyclist = require('cyclist');\nvar util = require('util');\nvar ParallelTransform = function (maxParallel, opts, ontransform) {\n  if (!(this instanceof ParallelTransform)) return new ParallelTransform(maxParallel, opts, ontransform);\n  if (typeof maxParallel === 'function') {\n    ontransform = maxParallel;\n    opts = null;\n    maxParallel = 1;\n  }\n  if (typeof opts === 'function') {\n    ontransform = opts;\n    opts = null;\n  }\n  if (!opts) opts = {};\n  if (!opts.highWaterMark) opts.highWaterMark = Math.max(maxParallel, 16);\n  if (opts.objectMode !== false) opts.objectMode = true;\n  Transform.call(this, opts);\n  this._maxParallel = maxParallel;\n  this._ontransform = ontransform;\n  this._destroyed = false;\n  this._flushed = false;\n  this._ordered = opts.ordered !== false;\n  this._buffer = this._ordered ? cyclist(maxParallel) : [];\n  this._top = 0;\n  this._bottom = 0;\n  this._ondrain = null;\n};\ninherits(ParallelTransform, Transform);\nParallelTransform.prototype.destroy = function () {\n  if (this._destroyed) return;\n  this._destroyed = true;\n  this.emit('close');\n};\nParallelTransform.prototype._transform = function (chunk, enc, callback) {\n  var self = this;\n  var pos = this._top++;\n  this._ontransform(chunk, function (err, data) {\n    if (self._destroyed) return;\n    if (err) {\n      self.emit('error', err);\n      self.push(null);\n      self.destroy();\n      return;\n    }\n    if (self._ordered) {\n      self._buffer.put(pos, data === undefined || data === null ? null : data);\n    } else {\n      self._buffer.push(data);\n    }\n    self._drain();\n  });\n  if (this._top - this._bottom < this._maxParallel) return callback();\n  this._ondrain = callback;\n};\nParallelTransform.prototype._flush = function (callback) {\n  this._flushed = true;\n  this._ondrain = callback;\n  this._drain();\n};\nParallelTransform.prototype._drain = function () {\n  if (this._ordered) {\n    while (this._buffer.get(this._bottom) !== undefined) {\n      var data = this._buffer.del(this._bottom++);\n      if (data === null) continue;\n      this.push(data);\n    }\n  } else {\n    while (this._buffer.length > 0) {\n      var data = this._buffer.pop();\n      this._bottom++;\n      if (data === null) continue;\n      this.push(data);\n    }\n  }\n  if (!this._drained() || !this._ondrain) return;\n  var ondrain = this._ondrain;\n  this._ondrain = null;\n  ondrain();\n};\nParallelTransform.prototype._drained = function () {\n  var diff = this._top - this._bottom;\n  return this._flushed ? !diff : diff < this._maxParallel;\n};\nmodule.exports = ParallelTransform;","map":{"version":3,"names":["Transform","require","inherits","cyclist","util","ParallelTransform","maxParallel","opts","ontransform","highWaterMark","Math","max","objectMode","call","_maxParallel","_ontransform","_destroyed","_flushed","_ordered","ordered","_buffer","_top","_bottom","_ondrain","prototype","destroy","emit","_transform","chunk","enc","callback","self","pos","err","data","push","put","undefined","_drain","_flush","get","del","length","pop","_drained","ondrain","diff","module","exports"],"sources":["/home/soon/bulletin-board/node_modules/parallel-transform/index.js"],"sourcesContent":["var Transform = require('readable-stream').Transform;\nvar inherits = require('inherits');\nvar cyclist = require('cyclist');\nvar util = require('util');\n\nvar ParallelTransform = function(maxParallel, opts, ontransform) {\n\tif (!(this instanceof ParallelTransform)) return new ParallelTransform(maxParallel, opts, ontransform);\n\n\tif (typeof maxParallel === 'function') {\n\t\tontransform = maxParallel;\n\t\topts = null;\n\t\tmaxParallel = 1;\n\t}\n\tif (typeof opts === 'function') {\n\t\tontransform = opts;\n\t\topts = null;\n\t}\n\n\tif (!opts) opts = {};\n\tif (!opts.highWaterMark) opts.highWaterMark = Math.max(maxParallel, 16);\n\tif (opts.objectMode !== false) opts.objectMode = true;\n\n\tTransform.call(this, opts);\n\n\tthis._maxParallel = maxParallel;\n\tthis._ontransform = ontransform;\n\tthis._destroyed = false;\n\tthis._flushed = false;\n\tthis._ordered = opts.ordered !== false;\n\tthis._buffer = this._ordered ? cyclist(maxParallel) : [];\n\tthis._top = 0;\n\tthis._bottom = 0;\n\tthis._ondrain = null;\n};\n\ninherits(ParallelTransform, Transform);\n\nParallelTransform.prototype.destroy = function() {\n\tif (this._destroyed) return;\n\tthis._destroyed = true;\n\tthis.emit('close');\n};\n\nParallelTransform.prototype._transform = function(chunk, enc, callback) {\n\tvar self = this;\n\tvar pos = this._top++;\n\n\tthis._ontransform(chunk, function(err, data) {\n\t\tif (self._destroyed) return;\n\t\tif (err) {\n\t\t\tself.emit('error', err);\n\t\t\tself.push(null);\n\t\t\tself.destroy();\n\t\t\treturn;\n\t\t}\n\t\tif (self._ordered) {\n\t\t\tself._buffer.put(pos, (data === undefined || data === null) ? null : data);\n\t\t}\n\t\telse {\n\t\t\tself._buffer.push(data);\n\t\t}\n\t\tself._drain();\n\t});\n\n\tif (this._top - this._bottom < this._maxParallel) return callback();\n\tthis._ondrain = callback;\n};\n\nParallelTransform.prototype._flush = function(callback) {\n\tthis._flushed = true;\n\tthis._ondrain = callback;\n\tthis._drain();\n};\n\nParallelTransform.prototype._drain = function() {\n\tif (this._ordered) {\n\t\twhile (this._buffer.get(this._bottom) !== undefined) {\n\t\t\tvar data = this._buffer.del(this._bottom++);\n\t\t\tif (data === null) continue;\n\t\t\tthis.push(data);\n\t\t}\n\t}\n\telse {\n\t\twhile (this._buffer.length > 0) {\n\t\t\tvar data =  this._buffer.pop();\n\t\t\tthis._bottom++;\n\t\t\tif (data === null) continue;\n\t\t\tthis.push(data);\n\t\t}\n\t}\n\n\n\tif (!this._drained() || !this._ondrain) return;\n\n\tvar ondrain = this._ondrain;\n\tthis._ondrain = null;\n\tondrain();\n};\n\nParallelTransform.prototype._drained = function() {\n\tvar diff = this._top - this._bottom;\n\treturn this._flushed ? !diff : diff < this._maxParallel;\n};\n\nmodule.exports = ParallelTransform;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}