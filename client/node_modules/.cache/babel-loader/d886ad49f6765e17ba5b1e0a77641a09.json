{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst path = require(\"path\");\nconst ParserHelpers = require(\"./ParserHelpers\");\nconst ConstDependency = require(\"./dependencies/ConstDependency\");\nconst NullFactory = require(\"./NullFactory\");\nclass NodeStuffPlugin {\n  constructor(options) {\n    this.options = options;\n  }\n  apply(compiler) {\n    const options = this.options;\n    compiler.hooks.compilation.tap(\"NodeStuffPlugin\", (compilation, {\n      normalModuleFactory\n    }) => {\n      compilation.dependencyFactories.set(ConstDependency, new NullFactory());\n      compilation.dependencyTemplates.set(ConstDependency, new ConstDependency.Template());\n      const handler = (parser, parserOptions) => {\n        if (parserOptions.node === false) return;\n        let localOptions = options;\n        if (parserOptions.node) {\n          localOptions = Object.assign({}, localOptions, parserOptions.node);\n        }\n        const setConstant = (expressionName, value) => {\n          parser.hooks.expression.for(expressionName).tap(\"NodeStuffPlugin\", () => {\n            parser.state.current.addVariable(expressionName, JSON.stringify(value));\n            return true;\n          });\n        };\n        const setModuleConstant = (expressionName, fn) => {\n          parser.hooks.expression.for(expressionName).tap(\"NodeStuffPlugin\", () => {\n            parser.state.current.addVariable(expressionName, JSON.stringify(fn(parser.state.module)));\n            return true;\n          });\n        };\n        const context = compiler.context;\n        if (localOptions.__filename) {\n          if (localOptions.__filename === \"mock\") {\n            setConstant(\"__filename\", \"/index.js\");\n          } else {\n            setModuleConstant(\"__filename\", module => path.relative(context, module.resource));\n          }\n          parser.hooks.evaluateIdentifier.for(\"__filename\").tap(\"NodeStuffPlugin\", expr => {\n            if (!parser.state.module) return;\n            const resource = parser.state.module.resource;\n            const i = resource.indexOf(\"?\");\n            return ParserHelpers.evaluateToString(i < 0 ? resource : resource.substr(0, i))(expr);\n          });\n        }\n        if (localOptions.__dirname) {\n          if (localOptions.__dirname === \"mock\") {\n            setConstant(\"__dirname\", \"/\");\n          } else {\n            setModuleConstant(\"__dirname\", module => path.relative(context, module.context));\n          }\n          parser.hooks.evaluateIdentifier.for(\"__dirname\").tap(\"NodeStuffPlugin\", expr => {\n            if (!parser.state.module) return;\n            return ParserHelpers.evaluateToString(parser.state.module.context)(expr);\n          });\n        }\n        parser.hooks.expression.for(\"require.extensions\").tap(\"NodeStuffPlugin\", ParserHelpers.expressionIsUnsupported(parser, \"require.extensions is not supported by webpack. Use a loader instead.\"));\n      };\n      normalModuleFactory.hooks.parser.for(\"javascript/auto\").tap(\"NodeStuffPlugin\", handler);\n      normalModuleFactory.hooks.parser.for(\"javascript/dynamic\").tap(\"NodeStuffPlugin\", handler);\n    });\n  }\n}\nmodule.exports = NodeStuffPlugin;","map":{"version":3,"names":["path","require","ParserHelpers","ConstDependency","NullFactory","NodeStuffPlugin","constructor","options","apply","compiler","hooks","compilation","tap","normalModuleFactory","dependencyFactories","set","dependencyTemplates","Template","handler","parser","parserOptions","node","localOptions","Object","assign","setConstant","expressionName","value","expression","for","state","current","addVariable","JSON","stringify","setModuleConstant","fn","module","context","__filename","relative","resource","evaluateIdentifier","expr","i","indexOf","evaluateToString","substr","__dirname","expressionIsUnsupported","exports"],"sources":["/home/soon/bulletin-board/node_modules/webpack/lib/NodeStuffPlugin.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst path = require(\"path\");\nconst ParserHelpers = require(\"./ParserHelpers\");\nconst ConstDependency = require(\"./dependencies/ConstDependency\");\n\nconst NullFactory = require(\"./NullFactory\");\n\nclass NodeStuffPlugin {\n\tconstructor(options) {\n\t\tthis.options = options;\n\t}\n\n\tapply(compiler) {\n\t\tconst options = this.options;\n\t\tcompiler.hooks.compilation.tap(\n\t\t\t\"NodeStuffPlugin\",\n\t\t\t(compilation, { normalModuleFactory }) => {\n\t\t\t\tcompilation.dependencyFactories.set(ConstDependency, new NullFactory());\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tConstDependency,\n\t\t\t\t\tnew ConstDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tconst handler = (parser, parserOptions) => {\n\t\t\t\t\tif (parserOptions.node === false) return;\n\n\t\t\t\t\tlet localOptions = options;\n\t\t\t\t\tif (parserOptions.node) {\n\t\t\t\t\t\tlocalOptions = Object.assign({}, localOptions, parserOptions.node);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst setConstant = (expressionName, value) => {\n\t\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t\t.for(expressionName)\n\t\t\t\t\t\t\t.tap(\"NodeStuffPlugin\", () => {\n\t\t\t\t\t\t\t\tparser.state.current.addVariable(\n\t\t\t\t\t\t\t\t\texpressionName,\n\t\t\t\t\t\t\t\t\tJSON.stringify(value)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\t\tconst setModuleConstant = (expressionName, fn) => {\n\t\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t\t.for(expressionName)\n\t\t\t\t\t\t\t.tap(\"NodeStuffPlugin\", () => {\n\t\t\t\t\t\t\t\tparser.state.current.addVariable(\n\t\t\t\t\t\t\t\t\texpressionName,\n\t\t\t\t\t\t\t\t\tJSON.stringify(fn(parser.state.module))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tconst context = compiler.context;\n\t\t\t\t\tif (localOptions.__filename) {\n\t\t\t\t\t\tif (localOptions.__filename === \"mock\") {\n\t\t\t\t\t\t\tsetConstant(\"__filename\", \"/index.js\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetModuleConstant(\"__filename\", module =>\n\t\t\t\t\t\t\t\tpath.relative(context, module.resource)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparser.hooks.evaluateIdentifier\n\t\t\t\t\t\t\t.for(\"__filename\")\n\t\t\t\t\t\t\t.tap(\"NodeStuffPlugin\", expr => {\n\t\t\t\t\t\t\t\tif (!parser.state.module) return;\n\t\t\t\t\t\t\t\tconst resource = parser.state.module.resource;\n\t\t\t\t\t\t\t\tconst i = resource.indexOf(\"?\");\n\t\t\t\t\t\t\t\treturn ParserHelpers.evaluateToString(\n\t\t\t\t\t\t\t\t\ti < 0 ? resource : resource.substr(0, i)\n\t\t\t\t\t\t\t\t)(expr);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (localOptions.__dirname) {\n\t\t\t\t\t\tif (localOptions.__dirname === \"mock\") {\n\t\t\t\t\t\t\tsetConstant(\"__dirname\", \"/\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetModuleConstant(\"__dirname\", module =>\n\t\t\t\t\t\t\t\tpath.relative(context, module.context)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparser.hooks.evaluateIdentifier\n\t\t\t\t\t\t\t.for(\"__dirname\")\n\t\t\t\t\t\t\t.tap(\"NodeStuffPlugin\", expr => {\n\t\t\t\t\t\t\t\tif (!parser.state.module) return;\n\t\t\t\t\t\t\t\treturn ParserHelpers.evaluateToString(\n\t\t\t\t\t\t\t\t\tparser.state.module.context\n\t\t\t\t\t\t\t\t)(expr);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(\"require.extensions\")\n\t\t\t\t\t\t.tap(\n\t\t\t\t\t\t\t\"NodeStuffPlugin\",\n\t\t\t\t\t\t\tParserHelpers.expressionIsUnsupported(\n\t\t\t\t\t\t\t\tparser,\n\t\t\t\t\t\t\t\t\"require.extensions is not supported by webpack. Use a loader instead.\"\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(\"javascript/auto\")\n\t\t\t\t\t.tap(\"NodeStuffPlugin\", handler);\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(\"javascript/dynamic\")\n\t\t\t\t\t.tap(\"NodeStuffPlugin\", handler);\n\t\t\t}\n\t\t);\n\t}\n}\nmodule.exports = NodeStuffPlugin;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}