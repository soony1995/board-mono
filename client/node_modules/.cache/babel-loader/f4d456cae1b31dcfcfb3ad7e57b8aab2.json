{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Generator = require(\"../Generator\");\nconst Template = require(\"../Template\");\nconst {\n  RawSource\n} = require(\"webpack-sources\");\nconst WebAssemblyImportDependency = require(\"../dependencies/WebAssemblyImportDependency\");\nconst WebAssemblyExportImportedDependency = require(\"../dependencies/WebAssemblyExportImportedDependency\");\n\n/** @typedef {import(\"../NormalModule\")} NormalModule */\n/** @typedef {import(\"../RuntimeTemplate\")} RuntimeTemplate */\n/** @typedef {import(\"webpack-sources\").Source} Source */\n/** @typedef {import(\"../Dependency\").DependencyTemplate} DependencyTemplate */\n\nclass WebAssemblyJavascriptGenerator extends Generator {\n  /**\n   * @param {NormalModule} module module for which the code should be generated\n   * @param {Map<Function, DependencyTemplate>} dependencyTemplates mapping from dependencies to templates\n   * @param {RuntimeTemplate} runtimeTemplate the runtime template\n   * @param {string} type which kind of code should be generated\n   * @returns {Source} generated code\n   */\n  generate(module, dependencyTemplates, runtimeTemplate, type) {\n    const initIdentifer = Array.isArray(module.usedExports) ? Template.numberToIdentifer(module.usedExports.length) : \"__webpack_init__\";\n    let needExportsCopy = false;\n    const importedModules = new Map();\n    const initParams = [];\n    let index = 0;\n    for (const dep of module.dependencies) {\n      const depAsAny = /** @type {any} */dep;\n      if (dep.module) {\n        let importData = importedModules.get(dep.module);\n        if (importData === undefined) {\n          importedModules.set(dep.module, importData = {\n            importVar: `m${index}`,\n            index,\n            request: \"userRequest\" in depAsAny ? depAsAny.userRequest : undefined,\n            names: new Set(),\n            reexports: []\n          });\n          index++;\n        }\n        if (dep instanceof WebAssemblyImportDependency) {\n          importData.names.add(dep.name);\n          if (dep.description.type === \"GlobalType\") {\n            const exportName = dep.name;\n            const usedName = dep.module && dep.module.isUsed(exportName);\n            if (dep.module) {\n              if (usedName) {\n                initParams.push(runtimeTemplate.exportFromImport({\n                  module: dep.module,\n                  request: dep.request,\n                  importVar: importData.importVar,\n                  originModule: module,\n                  exportName: dep.name,\n                  asiSafe: true,\n                  isCall: false,\n                  callContext: null\n                }));\n              }\n            }\n          }\n        }\n        if (dep instanceof WebAssemblyExportImportedDependency) {\n          importData.names.add(dep.name);\n          const usedName = module.isUsed(dep.exportName);\n          if (usedName) {\n            const exportProp = `${module.exportsArgument}[${JSON.stringify(usedName)}]`;\n            const defineStatement = Template.asString([`${exportProp} = ${runtimeTemplate.exportFromImport({\n              module: dep.module,\n              request: dep.request,\n              importVar: importData.importVar,\n              originModule: module,\n              exportName: dep.name,\n              asiSafe: true,\n              isCall: false,\n              callContext: null\n            })};`, `if(WebAssembly.Global) ${exportProp} = ` + `new WebAssembly.Global({ value: ${JSON.stringify(dep.valueType)} }, ${exportProp});`]);\n            importData.reexports.push(defineStatement);\n            needExportsCopy = true;\n          }\n        }\n      }\n    }\n    const importsCode = Template.asString(Array.from(importedModules, ([module, {\n      importVar,\n      request,\n      reexports\n    }]) => {\n      const importStatement = runtimeTemplate.importStatement({\n        module,\n        request,\n        importVar,\n        originModule: module\n      });\n      return importStatement + reexports.join(\"\\n\");\n    }));\n\n    // create source\n    const source = new RawSource(['\"use strict\";', \"// Instantiate WebAssembly module\", \"var wasmExports = __webpack_require__.w[module.i];\", !Array.isArray(module.usedExports) ? `__webpack_require__.r(${module.exportsArgument});` : \"\",\n    // this must be before import for circular dependencies\n    \"// export exports from WebAssembly module\", Array.isArray(module.usedExports) && !needExportsCopy ? `${module.moduleArgument}.exports = wasmExports;` : \"for(var name in wasmExports) \" + `if(name != ${JSON.stringify(initIdentifer)}) ` + `${module.exportsArgument}[name] = wasmExports[name];`, \"// exec imports from WebAssembly module (for esm order)\", importsCode, \"\", \"// exec wasm module\", `wasmExports[${JSON.stringify(initIdentifer)}](${initParams.join(\", \")})`].join(\"\\n\"));\n    return source;\n  }\n}\nmodule.exports = WebAssemblyJavascriptGenerator;","map":{"version":3,"names":["Generator","require","Template","RawSource","WebAssemblyImportDependency","WebAssemblyExportImportedDependency","WebAssemblyJavascriptGenerator","generate","module","dependencyTemplates","runtimeTemplate","type","initIdentifer","Array","isArray","usedExports","numberToIdentifer","length","needExportsCopy","importedModules","Map","initParams","index","dep","dependencies","depAsAny","importData","get","undefined","set","importVar","request","userRequest","names","Set","reexports","add","name","description","exportName","usedName","isUsed","push","exportFromImport","originModule","asiSafe","isCall","callContext","exportProp","exportsArgument","JSON","stringify","defineStatement","asString","valueType","importsCode","from","importStatement","join","source","moduleArgument","exports"],"sources":["/home/soon/bulletin-board/node_modules/webpack/lib/wasm/WebAssemblyJavascriptGenerator.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst Generator = require(\"../Generator\");\nconst Template = require(\"../Template\");\nconst { RawSource } = require(\"webpack-sources\");\nconst WebAssemblyImportDependency = require(\"../dependencies/WebAssemblyImportDependency\");\nconst WebAssemblyExportImportedDependency = require(\"../dependencies/WebAssemblyExportImportedDependency\");\n\n/** @typedef {import(\"../NormalModule\")} NormalModule */\n/** @typedef {import(\"../RuntimeTemplate\")} RuntimeTemplate */\n/** @typedef {import(\"webpack-sources\").Source} Source */\n/** @typedef {import(\"../Dependency\").DependencyTemplate} DependencyTemplate */\n\nclass WebAssemblyJavascriptGenerator extends Generator {\n\t/**\n\t * @param {NormalModule} module module for which the code should be generated\n\t * @param {Map<Function, DependencyTemplate>} dependencyTemplates mapping from dependencies to templates\n\t * @param {RuntimeTemplate} runtimeTemplate the runtime template\n\t * @param {string} type which kind of code should be generated\n\t * @returns {Source} generated code\n\t */\n\tgenerate(module, dependencyTemplates, runtimeTemplate, type) {\n\t\tconst initIdentifer = Array.isArray(module.usedExports)\n\t\t\t? Template.numberToIdentifer(module.usedExports.length)\n\t\t\t: \"__webpack_init__\";\n\n\t\tlet needExportsCopy = false;\n\t\tconst importedModules = new Map();\n\t\tconst initParams = [];\n\t\tlet index = 0;\n\t\tfor (const dep of module.dependencies) {\n\t\t\tconst depAsAny = /** @type {any} */ (dep);\n\t\t\tif (dep.module) {\n\t\t\t\tlet importData = importedModules.get(dep.module);\n\t\t\t\tif (importData === undefined) {\n\t\t\t\t\timportedModules.set(\n\t\t\t\t\t\tdep.module,\n\t\t\t\t\t\t(importData = {\n\t\t\t\t\t\t\timportVar: `m${index}`,\n\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\trequest:\n\t\t\t\t\t\t\t\t\"userRequest\" in depAsAny ? depAsAny.userRequest : undefined,\n\t\t\t\t\t\t\tnames: new Set(),\n\t\t\t\t\t\t\treexports: []\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t\tif (dep instanceof WebAssemblyImportDependency) {\n\t\t\t\t\timportData.names.add(dep.name);\n\t\t\t\t\tif (dep.description.type === \"GlobalType\") {\n\t\t\t\t\t\tconst exportName = dep.name;\n\t\t\t\t\t\tconst usedName = dep.module && dep.module.isUsed(exportName);\n\n\t\t\t\t\t\tif (dep.module) {\n\t\t\t\t\t\t\tif (usedName) {\n\t\t\t\t\t\t\t\tinitParams.push(\n\t\t\t\t\t\t\t\t\truntimeTemplate.exportFromImport({\n\t\t\t\t\t\t\t\t\t\tmodule: dep.module,\n\t\t\t\t\t\t\t\t\t\trequest: dep.request,\n\t\t\t\t\t\t\t\t\t\timportVar: importData.importVar,\n\t\t\t\t\t\t\t\t\t\toriginModule: module,\n\t\t\t\t\t\t\t\t\t\texportName: dep.name,\n\t\t\t\t\t\t\t\t\t\tasiSafe: true,\n\t\t\t\t\t\t\t\t\t\tisCall: false,\n\t\t\t\t\t\t\t\t\t\tcallContext: null\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (dep instanceof WebAssemblyExportImportedDependency) {\n\t\t\t\t\timportData.names.add(dep.name);\n\t\t\t\t\tconst usedName = module.isUsed(dep.exportName);\n\t\t\t\t\tif (usedName) {\n\t\t\t\t\t\tconst exportProp = `${module.exportsArgument}[${JSON.stringify(\n\t\t\t\t\t\t\tusedName\n\t\t\t\t\t\t)}]`;\n\t\t\t\t\t\tconst defineStatement = Template.asString([\n\t\t\t\t\t\t\t`${exportProp} = ${runtimeTemplate.exportFromImport({\n\t\t\t\t\t\t\t\tmodule: dep.module,\n\t\t\t\t\t\t\t\trequest: dep.request,\n\t\t\t\t\t\t\t\timportVar: importData.importVar,\n\t\t\t\t\t\t\t\toriginModule: module,\n\t\t\t\t\t\t\t\texportName: dep.name,\n\t\t\t\t\t\t\t\tasiSafe: true,\n\t\t\t\t\t\t\t\tisCall: false,\n\t\t\t\t\t\t\t\tcallContext: null\n\t\t\t\t\t\t\t})};`,\n\t\t\t\t\t\t\t`if(WebAssembly.Global) ${exportProp} = ` +\n\t\t\t\t\t\t\t\t`new WebAssembly.Global({ value: ${JSON.stringify(\n\t\t\t\t\t\t\t\t\tdep.valueType\n\t\t\t\t\t\t\t\t)} }, ${exportProp});`\n\t\t\t\t\t\t]);\n\t\t\t\t\t\timportData.reexports.push(defineStatement);\n\t\t\t\t\t\tneedExportsCopy = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst importsCode = Template.asString(\n\t\t\tArray.from(\n\t\t\t\timportedModules,\n\t\t\t\t([module, { importVar, request, reexports }]) => {\n\t\t\t\t\tconst importStatement = runtimeTemplate.importStatement({\n\t\t\t\t\t\tmodule,\n\t\t\t\t\t\trequest,\n\t\t\t\t\t\timportVar,\n\t\t\t\t\t\toriginModule: module\n\t\t\t\t\t});\n\t\t\t\t\treturn importStatement + reexports.join(\"\\n\");\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\t// create source\n\t\tconst source = new RawSource(\n\t\t\t[\n\t\t\t\t'\"use strict\";',\n\t\t\t\t\"// Instantiate WebAssembly module\",\n\t\t\t\t\"var wasmExports = __webpack_require__.w[module.i];\",\n\n\t\t\t\t!Array.isArray(module.usedExports)\n\t\t\t\t\t? `__webpack_require__.r(${module.exportsArgument});`\n\t\t\t\t\t: \"\",\n\n\t\t\t\t// this must be before import for circular dependencies\n\t\t\t\t\"// export exports from WebAssembly module\",\n\t\t\t\tArray.isArray(module.usedExports) && !needExportsCopy\n\t\t\t\t\t? `${module.moduleArgument}.exports = wasmExports;`\n\t\t\t\t\t: \"for(var name in wasmExports) \" +\n\t\t\t\t\t  `if(name != ${JSON.stringify(initIdentifer)}) ` +\n\t\t\t\t\t  `${module.exportsArgument}[name] = wasmExports[name];`,\n\t\t\t\t\"// exec imports from WebAssembly module (for esm order)\",\n\t\t\t\timportsCode,\n\t\t\t\t\"\",\n\t\t\t\t\"// exec wasm module\",\n\t\t\t\t`wasmExports[${JSON.stringify(initIdentifer)}](${initParams.join(\n\t\t\t\t\t\", \"\n\t\t\t\t)})`\n\t\t\t].join(\"\\n\")\n\t\t);\n\t\treturn source;\n\t}\n}\n\nmodule.exports = WebAssemblyJavascriptGenerator;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}