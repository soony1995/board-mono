{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst path = require(\"path\");\nmodule.exports = class MainFieldPlugin {\n  constructor(source, options, target) {\n    this.source = source;\n    this.options = options;\n    this.target = target;\n  }\n  apply(resolver) {\n    const target = resolver.ensureHook(this.target);\n    resolver.getHook(this.source).tapAsync(\"MainFieldPlugin\", (request, resolveContext, callback) => {\n      if (request.path !== request.descriptionFileRoot) return callback();\n      if (request.alreadyTriedMainField === request.descriptionFilePath) return callback();\n      const content = request.descriptionFileData;\n      const filename = path.basename(request.descriptionFilePath);\n      let mainModule;\n      const field = this.options.name;\n      if (Array.isArray(field)) {\n        let current = content;\n        for (let j = 0; j < field.length; j++) {\n          if (current === null || typeof current !== \"object\") {\n            current = null;\n            break;\n          }\n          current = current[field[j]];\n        }\n        if (typeof current === \"string\") {\n          mainModule = current;\n        }\n      } else {\n        if (typeof content[field] === \"string\") {\n          mainModule = content[field];\n        }\n      }\n      if (!mainModule) return callback();\n      if (this.options.forceRelative && !/^\\.\\.?\\//.test(mainModule)) mainModule = \"./\" + mainModule;\n      const obj = Object.assign({}, request, {\n        request: mainModule,\n        alreadyTriedMainField: request.descriptionFilePath\n      });\n      return resolver.doResolve(target, obj, \"use \" + mainModule + \" from \" + this.options.name + \" in \" + filename, resolveContext, callback);\n    });\n  }\n};","map":{"version":3,"names":["path","require","module","exports","MainFieldPlugin","constructor","source","options","target","apply","resolver","ensureHook","getHook","tapAsync","request","resolveContext","callback","descriptionFileRoot","alreadyTriedMainField","descriptionFilePath","content","descriptionFileData","filename","basename","mainModule","field","name","Array","isArray","current","j","length","forceRelative","test","obj","Object","assign","doResolve"],"sources":["/home/soon/bulletin-board/node_modules/enhanced-resolve/lib/MainFieldPlugin.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst path = require(\"path\");\n\nmodule.exports = class MainFieldPlugin {\n\tconstructor(source, options, target) {\n\t\tthis.source = source;\n\t\tthis.options = options;\n\t\tthis.target = target;\n\t}\n\n\tapply(resolver) {\n\t\tconst target = resolver.ensureHook(this.target);\n\t\tresolver\n\t\t\t.getHook(this.source)\n\t\t\t.tapAsync(\"MainFieldPlugin\", (request, resolveContext, callback) => {\n\t\t\t\tif (request.path !== request.descriptionFileRoot) return callback();\n\t\t\t\tif (request.alreadyTriedMainField === request.descriptionFilePath)\n\t\t\t\t\treturn callback();\n\t\t\t\tconst content = request.descriptionFileData;\n\t\t\t\tconst filename = path.basename(request.descriptionFilePath);\n\t\t\t\tlet mainModule;\n\t\t\t\tconst field = this.options.name;\n\t\t\t\tif (Array.isArray(field)) {\n\t\t\t\t\tlet current = content;\n\t\t\t\t\tfor (let j = 0; j < field.length; j++) {\n\t\t\t\t\t\tif (current === null || typeof current !== \"object\") {\n\t\t\t\t\t\t\tcurrent = null;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrent = current[field[j]];\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof current === \"string\") {\n\t\t\t\t\t\tmainModule = current;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof content[field] === \"string\") {\n\t\t\t\t\t\tmainModule = content[field];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!mainModule) return callback();\n\t\t\t\tif (this.options.forceRelative && !/^\\.\\.?\\//.test(mainModule))\n\t\t\t\t\tmainModule = \"./\" + mainModule;\n\t\t\t\tconst obj = Object.assign({}, request, {\n\t\t\t\t\trequest: mainModule,\n\t\t\t\t\talreadyTriedMainField: request.descriptionFilePath\n\t\t\t\t});\n\t\t\t\treturn resolver.doResolve(\n\t\t\t\t\ttarget,\n\t\t\t\t\tobj,\n\t\t\t\t\t\"use \" +\n\t\t\t\t\t\tmainModule +\n\t\t\t\t\t\t\" from \" +\n\t\t\t\t\t\tthis.options.name +\n\t\t\t\t\t\t\" in \" +\n\t\t\t\t\t\tfilename,\n\t\t\t\t\tresolveContext,\n\t\t\t\t\tcallback\n\t\t\t\t);\n\t\t\t});\n\t}\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,YAAY;;AAEZ,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;AAE5BC,MAAM,CAACC,OAAO,GAAG,MAAMC,eAAe,CAAC;EACtCC,WAAWA,CAACC,MAAM,EAAEC,OAAO,EAAEC,MAAM,EAAE;IACpC,IAAI,CAACF,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,MAAM,GAAGA,MAAM;EACrB;EAEAC,KAAKA,CAACC,QAAQ,EAAE;IACf,MAAMF,MAAM,GAAGE,QAAQ,CAACC,UAAU,CAAC,IAAI,CAACH,MAAM,CAAC;IAC/CE,QAAQ,CACNE,OAAO,CAAC,IAAI,CAACN,MAAM,CAAC,CACpBO,QAAQ,CAAC,iBAAiB,EAAE,CAACC,OAAO,EAAEC,cAAc,EAAEC,QAAQ,KAAK;MACnE,IAAIF,OAAO,CAACd,IAAI,KAAKc,OAAO,CAACG,mBAAmB,EAAE,OAAOD,QAAQ,CAAC,CAAC;MACnE,IAAIF,OAAO,CAACI,qBAAqB,KAAKJ,OAAO,CAACK,mBAAmB,EAChE,OAAOH,QAAQ,CAAC,CAAC;MAClB,MAAMI,OAAO,GAAGN,OAAO,CAACO,mBAAmB;MAC3C,MAAMC,QAAQ,GAAGtB,IAAI,CAACuB,QAAQ,CAACT,OAAO,CAACK,mBAAmB,CAAC;MAC3D,IAAIK,UAAU;MACd,MAAMC,KAAK,GAAG,IAAI,CAAClB,OAAO,CAACmB,IAAI;MAC/B,IAAIC,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,EAAE;QACzB,IAAII,OAAO,GAAGT,OAAO;QACrB,KAAK,IAAIU,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,KAAK,CAACM,MAAM,EAAED,CAAC,EAAE,EAAE;UACtC,IAAID,OAAO,KAAK,IAAI,IAAI,OAAOA,OAAO,KAAK,QAAQ,EAAE;YACpDA,OAAO,GAAG,IAAI;YACd;UACD;UACAA,OAAO,GAAGA,OAAO,CAACJ,KAAK,CAACK,CAAC,CAAC,CAAC;QAC5B;QACA,IAAI,OAAOD,OAAO,KAAK,QAAQ,EAAE;UAChCL,UAAU,GAAGK,OAAO;QACrB;MACD,CAAC,MAAM;QACN,IAAI,OAAOT,OAAO,CAACK,KAAK,CAAC,KAAK,QAAQ,EAAE;UACvCD,UAAU,GAAGJ,OAAO,CAACK,KAAK,CAAC;QAC5B;MACD;MACA,IAAI,CAACD,UAAU,EAAE,OAAOR,QAAQ,CAAC,CAAC;MAClC,IAAI,IAAI,CAACT,OAAO,CAACyB,aAAa,IAAI,CAAC,UAAU,CAACC,IAAI,CAACT,UAAU,CAAC,EAC7DA,UAAU,GAAG,IAAI,GAAGA,UAAU;MAC/B,MAAMU,GAAG,GAAGC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEtB,OAAO,EAAE;QACtCA,OAAO,EAAEU,UAAU;QACnBN,qBAAqB,EAAEJ,OAAO,CAACK;MAChC,CAAC,CAAC;MACF,OAAOT,QAAQ,CAAC2B,SAAS,CACxB7B,MAAM,EACN0B,GAAG,EACH,MAAM,GACLV,UAAU,GACV,QAAQ,GACR,IAAI,CAACjB,OAAO,CAACmB,IAAI,GACjB,MAAM,GACNJ,QAAQ,EACTP,cAAc,EACdC,QACD,CAAC;IACF,CAAC,CAAC;EACJ;AACD,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script"}