{"ast":null,"code":"var eos = require('end-of-stream');\nvar shift = require('stream-shift');\nmodule.exports = each;\nfunction each(stream, fn, cb) {\n  var want = true;\n  var error = null;\n  var ended = false;\n  var running = false;\n  var calling = false;\n  stream.on('readable', onreadable);\n  onreadable();\n  if (cb) eos(stream, {\n    readable: true,\n    writable: false\n  }, done);\n  return stream;\n  function done(err) {\n    if (!error) error = err;\n    ended = true;\n    if (!running) cb(error);\n  }\n  function onreadable() {\n    if (want) read();\n  }\n  function afterRead(err) {\n    running = false;\n    if (err) {\n      error = err;\n      if (ended) return cb(error);\n      stream.destroy(err);\n      return;\n    }\n    if (ended) return cb(error);\n    if (!calling) read();\n  }\n  function read() {\n    while (!running && !ended) {\n      want = false;\n      var data = shift(stream);\n      if (ended) return;\n      if (data === null) {\n        want = true;\n        return;\n      }\n      running = true;\n      calling = true;\n      fn(data, afterRead);\n      calling = false;\n    }\n  }\n}","map":{"version":3,"names":["eos","require","shift","module","exports","each","stream","fn","cb","want","error","ended","running","calling","on","onreadable","readable","writable","done","err","read","afterRead","destroy","data"],"sources":["/home/soon/bulletin-board/node_modules/stream-each/index.js"],"sourcesContent":["var eos = require('end-of-stream')\nvar shift = require('stream-shift')\n\nmodule.exports = each\n\nfunction each (stream, fn, cb) {\n  var want = true\n  var error = null\n  var ended = false\n  var running = false\n  var calling = false\n\n  stream.on('readable', onreadable)\n  onreadable()\n\n  if (cb) eos(stream, {readable: true, writable: false}, done)\n  return stream\n\n  function done (err) {\n    if (!error) error = err\n    ended = true\n    if (!running) cb(error)\n  }\n\n  function onreadable () {\n    if (want) read()\n  }\n\n  function afterRead (err) {\n    running = false\n\n    if (err) {\n      error = err\n      if (ended) return cb(error)\n      stream.destroy(err)\n      return\n    }\n    if (ended) return cb(error)\n    if (!calling) read()\n  }\n\n  function read () {\n    while (!running && !ended) {\n      want = false\n\n      var data = shift(stream)\n      if (ended) return\n      if (data === null) {\n        want = true\n        return\n      }\n\n      running = true\n      calling = true\n      fn(data, afterRead)\n      calling = false\n    }\n  }\n}\n"],"mappings":"AAAA,IAAIA,GAAG,GAAGC,OAAO,CAAC,eAAe,CAAC;AAClC,IAAIC,KAAK,GAAGD,OAAO,CAAC,cAAc,CAAC;AAEnCE,MAAM,CAACC,OAAO,GAAGC,IAAI;AAErB,SAASA,IAAIA,CAAEC,MAAM,EAAEC,EAAE,EAAEC,EAAE,EAAE;EAC7B,IAAIC,IAAI,GAAG,IAAI;EACf,IAAIC,KAAK,GAAG,IAAI;EAChB,IAAIC,KAAK,GAAG,KAAK;EACjB,IAAIC,OAAO,GAAG,KAAK;EACnB,IAAIC,OAAO,GAAG,KAAK;EAEnBP,MAAM,CAACQ,EAAE,CAAC,UAAU,EAAEC,UAAU,CAAC;EACjCA,UAAU,CAAC,CAAC;EAEZ,IAAIP,EAAE,EAAER,GAAG,CAACM,MAAM,EAAE;IAACU,QAAQ,EAAE,IAAI;IAAEC,QAAQ,EAAE;EAAK,CAAC,EAAEC,IAAI,CAAC;EAC5D,OAAOZ,MAAM;EAEb,SAASY,IAAIA,CAAEC,GAAG,EAAE;IAClB,IAAI,CAACT,KAAK,EAAEA,KAAK,GAAGS,GAAG;IACvBR,KAAK,GAAG,IAAI;IACZ,IAAI,CAACC,OAAO,EAAEJ,EAAE,CAACE,KAAK,CAAC;EACzB;EAEA,SAASK,UAAUA,CAAA,EAAI;IACrB,IAAIN,IAAI,EAAEW,IAAI,CAAC,CAAC;EAClB;EAEA,SAASC,SAASA,CAAEF,GAAG,EAAE;IACvBP,OAAO,GAAG,KAAK;IAEf,IAAIO,GAAG,EAAE;MACPT,KAAK,GAAGS,GAAG;MACX,IAAIR,KAAK,EAAE,OAAOH,EAAE,CAACE,KAAK,CAAC;MAC3BJ,MAAM,CAACgB,OAAO,CAACH,GAAG,CAAC;MACnB;IACF;IACA,IAAIR,KAAK,EAAE,OAAOH,EAAE,CAACE,KAAK,CAAC;IAC3B,IAAI,CAACG,OAAO,EAAEO,IAAI,CAAC,CAAC;EACtB;EAEA,SAASA,IAAIA,CAAA,EAAI;IACf,OAAO,CAACR,OAAO,IAAI,CAACD,KAAK,EAAE;MACzBF,IAAI,GAAG,KAAK;MAEZ,IAAIc,IAAI,GAAGrB,KAAK,CAACI,MAAM,CAAC;MACxB,IAAIK,KAAK,EAAE;MACX,IAAIY,IAAI,KAAK,IAAI,EAAE;QACjBd,IAAI,GAAG,IAAI;QACX;MACF;MAEAG,OAAO,GAAG,IAAI;MACdC,OAAO,GAAG,IAAI;MACdN,EAAE,CAACgB,IAAI,EAAEF,SAAS,CAAC;MACnBR,OAAO,GAAG,KAAK;IACjB;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"script"}